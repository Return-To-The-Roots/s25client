
FIND_PACKAGE(SDL)

IF (SDL_FOUND)
	FIND_PACKAGE(Boost 1.55.0 REQUIRED)
	INCLUDE(CMakeMacroCorrectLib)
	
	CORRECT_LIB(SDL_LIBRARY SDL)

	INCLUDE_DIRECTORIES(${PROJECT_SOURCE_DIR}/driver/src ${SDL_INCLUDE_DIR} ${Boost_INCLUDE_DIR})

	INCLUDE(AddFileDependencies)
	ADD_FILE_DEPENDENCIES(${PROJECT_SOURCE_DIR}/build_version.cpp ${CMAKE_BINARY_DIR}/build_version_defines.h)

	ADD_LIBRARY(videoSDL SHARED VideoSDL.cpp VideoSDL.h main.h ${PROJECT_SOURCE_DIR}/build_version.cpp ${PROJECT_SOURCE_DIR}/driver/src/DriverInterface.cpp)
	ADD_DEPENDENCIES(videoSDL updateversion)
    IF( NOT "${CMAKE_SYSTEM_NAME}" STREQUAL "Windows" )
	    CHECK_CXX_COMPILER_FLAG(-fPIC FLAG_FPIC_SUPPORTED)
	    IF(FLAG_FPIC_SUPPORTED)
		    ADD_DEFINITIONS(-fPIC)
	    ENDIF()
    ENDIF()

	TARGET_LINK_LIBRARIES(videoSDL videodrv ${SDL_LIBRARY})

	SET(SL_PREFIX ${CMAKE_SHARED_LIBRARY_PREFIX})
	IF ( "${CMAKE_SYSTEM_NAME}" STREQUAL "Windows")
		ADD_DEFINITIONS(-DBUILD_DLL)
		SET(SL_PREFIX "")
	ENDIF ( "${CMAKE_SYSTEM_NAME}" STREQUAL "Windows")

	IF (MSVC)
		SET_TARGET_PROPERTIES(videoSDL PROPERTIES
			RUNTIME_OUTPUT_DIRECTORY_RELEASE "${CMAKE_BINARY_DIR}/${RTTR_DRIVERDIR}/video"
			RUNTIME_OUTPUT_DIRECTORY_DEBUG "${CMAKE_BINARY_DIR}/${RTTR_DRIVERDIR}/video"
			RUNTIME_OUTPUT_DIRECTORY_RELWITHDEBINFO "${CMAKE_BINARY_DIR}/${RTTR_DRIVERDIR}/video"
		)
	ELSE()
		ADD_CUSTOM_COMMAND(TARGET videoSDL POST_BUILD COMMAND ln -fvs SDL/src/${SL_PREFIX}videoSDL${CMAKE_SHARED_LIBRARY_SUFFIX} ../../videoSDL${CMAKE_SHARED_LIBRARY_SUFFIX})
	ENDIF()
	
	INSTALL(TARGETS videoSDL 
		RUNTIME DESTINATION ${RTTR_DRIVERDIR}/video 
		LIBRARY DESTINATION ${RTTR_DRIVERDIR}/video
		ARCHIVE DESTINATION ${RTTR_DRIVERDIR}/video
	)
ELSE (SDL_FOUND)
	MESSAGE(WARNING ": SDL library not found: Not building SDL videodriver")
ENDIF (SDL_FOUND)

#################################################################################
